# 路径基础

贝塞尔曲线是iOS最重要的绘制工具之一，可以用来绘制轮廓，裁剪路径，定义动画路径，等等。不论你是创建自定义视图中的某一个元素，或是添加一个PS级别的效果，或者基础的任务比如画线和圆，使用UIBezierPath类都可以轻易且有效的实现。

### 为什么使用贝塞尔

当创建一个按钮或是斜角，阴影或是图案的时候，贝塞尔曲线都能提供有效且灵活的解决方案。如图4-1，所有的截屏都是由各种贝塞尔曲线的元素绘制而组成的。
<img src="./4-1.png" alt="图4.1" title="图4.1" width="700"/>
上方的截屏来自一个简单的音频app，他是蓝白相间的图像还有黑色的音频线条，他们都会通过连续的或断续的线条绘制的。这些线条是非常常用的，在很多绘制的情况下都会用到。
下方的图就比较复杂了，兔子的几何图存在单独的一个贝塞尔曲线中，被圆角矩形包围，覆盖在按钮上的弧度也是贝塞尔曲线为基础的椭圆。贝塞尔曲线同事裁剪边界形状的路径，用来定义限制微妙的颜色变化的范围，从而得到3D的效果。
虽然这两个截图的绘制效果截然不同，类的操作方式却是相同的。如果你想在你的app中使用UIKit绘制，你需要和UIBezierPath类建立起更加亲密且舒适的关系。

### 类的便捷方法

UIBezierPath类的方法创建矩形，椭圆，圆角矩形和弧，提供只用一个参数就可以使用的路径风格元素的方法。

* Rectangles —— bezierPathWithRect：用于绘制界面中的各种矩形元素。你可以使用该方法绘制任何种类的矩形。
* Ovals and circle —— bezierPathWithOvalInRect：提供绘制任何形状的圆和椭圆的工具。
* Rounded rectangles —— bezierPathWithRoundedRect：cornerRadius：可以用于创建iOS设计师非常喜欢的圆角矩形，该路径非常适合按钮和提示框，还有很多其他的视图元素。
* Corner-controlled rounded rectangles ——bezierPathWithRoundedRect:byRoundingCorners:cornerRadii:允许你仅在矩形的某一个或几个角进行圆角操作。这个方法很方便的帮助你创建一些并不想要四个角都是圆角的控件。
* Arcs —— bezierPathWithArcCenter：radius：startAngle：endAngle：clockwise：通过定义起始角度和结尾角度来绘制弧线，通过弧线增加视觉修饰，来创建个新的视觉分割，以达到优化全局GUI的效果。

贝塞尔曲线类方法提供一个基础的绘制起点，如代码4-1的例子演示的那样，这段代码通过结合多个形状创建一个新的贝塞尔曲线。每一步，添加一个路径，最后凑成一个如图4-2所示的“脸”的图像。
如代码4-1所示的，贝塞尔曲线单例内部是易变的。你可以添加形状和元素让他们变成一个新的图像。此外，路径也不必是连续的，如图4-2，他们明显是由不相交的子形状构成的，每一个都可以单独绘制。

> 注意：这里使用的代码只是例子，仅展示绘制时需要的API的简例，而非之前书中的代码，可以直接用在项目中。


<img src="./4-2.png" alt="图4.2" title="图4.2" width="700"/>

尽管你可能会在绘制过于复杂的路径时遇到性能的问题，但其实更多的时候是在处理用户交互的操作时才会发生。我会将绘图应用程序中的绘图表示为路径。比如幼儿园的孩子，没有谁比他们更会长时间的绘制五到十分钟，甚至都不带抬手指的，过长的路径会导致性能的下降。你的普通预构建的路径中加入矢量图，都不应该忽略掉这个问题。
有时候你也想分割开路径，一旦绘制，j路径的秒变颜色和填充颜色都会应用在所有的元素中。当你需要多种绘制的风格时，你需要创建多个独立的路径，每一个都是一个独立的统一操作单元。

```
CGRect fullRect = (CGRect)(.size = size);

//Establish a new path
UIBezierPath *bezierPath = [UIBezierPath bezierPath];

//Create the face outline
//and append it to the path
CGRect inset = CGRectInset(fullRect, 32, 32);
UIBezierPath *faceOutline = [UIBezierPath bezierPathWithOvalInRect:inset];

[bezierPath appendPath:faceOutline];

//Move in again, for the eyes and mouth
CGRect insetAgain = CGRectInset(inset, 64, 64);

//Calculate a radius
CGPoint referencePoint = CGPointMake(CGRectGetMinX(insetAgain),CGRectGetMaxY(insetAgain));
CGPoint center = RectGetCenter(inset);
CGFloat radius = PointDistanceFromPoint(referencePoint, center);

//Add a smile from 40 degrees around to 140 degree
UIBezierPath *smile = [UIBezierPath bezierPathWithArcCenter:center radius:radius startAngle:RadianFromDegrees(140) endAngle:RadiansFromDegrees(40) clockwise:NO];
[bezierPath appendPath:smile];

//Build Eye 1
CGPoint p1 = CGPointMake(CGRectGetMinX(insetAgain),CGRectGetMinY(insetAgain));
CGRect eyeRect1 = RectAroundCenter(p1, CGSizeMake(20,20));
UIBezierPath *eye1 = [UIBezierPath bezierPathWithRect:eyeRect1];
[bezierPath appendPath:eye1];

//Build Eye 2
CGPoint p2 = CGPointMake(CGRectGetMaxX(insetAgain),CGRectGetMinY(insetAgain));
CGRect eyeRect2 = RectAroundCenter(p1, CGSizeMake(20,20));
UIBezierPath *eye2 = [UIBezierPath bezierPathWithRect:eyeRect2];
[bezierPath appendPath:eye2];


//Draw the complete path
bezierPath.lineWidth = 4;
[bezierPath stroke];
```
### 嵌套圆角矩形
图4-3显示了两个嵌套的圆角矩形，构建圆角矩形在iOS绘图任务中非常常见，每个路径都被填充和描边：外部线宽为2点宽，内部为1点宽，图4-3展示了一个很常见的错误。

<img src="./4-3.png" alt="图4.3" title="图4.3" width="700"/>

仔细观察每个图像的四个角。第一张图和第二张图的拐角半径不同。左图内部矩形缩进4点，并使用12曲度点圆角。
```
UIBezierPath *path2 = [UIBezierPath bezierPathWithRoundedRect:CGRectInset(destinationRect, 4, 4) cornerRadius:12];
```
第二个图同样向内缩进4点，但是曲度改为8，使两套路径之间更好的拟合，确保两条曲线在平行的位置从始至终都有不错的视觉效果。


### 创建路径
当系统提供的路径（如矩形和椭圆）不足以满足您的需求时，您可以迭代地构建路径。通过逐点布局，来添加曲线和直线。
每个贝塞尔曲线都可以包括多种几何元素，包括如下：

* 通过moveToPointc：创建定位
* 通过addLineToPoint：创建直线
* 通过addCurveToPoint:controlPoint1:controlPoint2:创建三次贝塞尔曲线线段
* 通过addArcToCenter:radius:startAngle:endAngle:clockwise:创建弧线。

图4-4显示了一个由一系列三次曲线线段组成的星星。代码4-2有详细的创建过程，他创建了一个新的路径，起点为p0，然后通过一系列的三次曲线来构成星形。

<img src="./4-4.png" alt="图4.4" title="图4.4" width="700"/>

这个代码看起来不是特别友好，确实，它就是这样的。构建贝塞尔曲线时非常不友好的过程。事实上，这个特别的形状我是从Photoshop那边创建的。我画了这个形状，然后保存到psd中，然后使用PaintCode（Mac商城中的Photoshop内构项目99美元+20美元）将矢量图转换为一系列的objective-C的请求。
说到绘图，最适合表现形状的工具往往都不在Xcode里。但是，在设计了形状之后，你的代码有很多事情可以做，来管理和优化你的app素材。因此，你不必担心在Photoshop或其他工具中建立的素材会有精确度的问题。你会发现UIBezierPath实例展示了矢量艺术。你可以缩放，平移，旋转等等，更具你的需求来调整素材。

```
//Create new path, courtesy of PaintCode (paintcodeapp.com)
UIBezierPath *bezierPath = [UIBezierPath bezierPath];

//Move to the start of the path, at the right side
[bezierPath moveToPoint:CGPointMake(883.23, 430.54)]//p0

//Add the cubic segments
[bezierPath addCurveToPoint:CGPointMake(749.25, 358.4)  //p1
              controlPoint1:CGPointMake(873.68, 370.91)
              controlPoint2:CGPointMake(809.43,367.95)];
[bezierPath addCurveToPoint:CGPointMake(661.1, 353.25)  //p2
              controlPoint1:CGPointMake(721.92, 354.07)
              controlPoint2:CGPointMake(690.4,362.15)];
[bezierPath addCurveToPoint:CGPointMake(492.9, 156.15)  //p3
              controlPoint1:CGPointMake(575.39, 316.25)
              controlPoint2:CGPointMake(629.21, 115.47)];
[bezierPath addCurveToPoint:CGPointMake(461.98, 169.03)  //p4
              controlPoint1:CGPointMake(482.59, 160.45)
              controlPoint2:CGPointMake(472.29, 164.74)];
[bezierPath addCurveToPoint:CGPointMake(365.36, 345.52)  //p5
              controlPoint1:CGPointMake(409.88, 207.98)
              controlPoint2:CGPointMake(425.22, 305.23)];
[bezierPath addCurveToPoint:CGPointMake(262.31, 358.4)  //p6
              controlPoint1:CGPointMake(341.9, 364.44)
              controlPoint2:CGPointMake(300.41, 352.37)];
[bezierPath addCurveToPoint:CGPointMake(133.48, 460.17)  //p7
              controlPoint1:CGPointMake(200.89, 368.12)
              controlPoint2:CGPointMake(118.62, 376.61)];
[bezierPath addCurveToPoint:CGPointMake(277.77, 622.49)  //p8
              controlPoint1:CGPointMake(148.46, 544.36)
              controlPoint2:CGPointMake(258.55, 544.36)];
[bezierPath addCurveToPoint:CGPointMake(277.77, 871.12)  //p9
              controlPoint1:CGPointMake(201.89, 700.9)
              controlPoint2:CGPointMake(193.24, 819.76)];
[bezierPath addCurveToPoint:CGPointMake(513.51, 798.97)  //p10
              controlPoint1:CGPointMake(382.76, 934.9)
              controlPoint2:CGPointMake(435.24, 786.06)];
[bezierPath addCurveToPoint:CGPointMake(723.49, 878.84)  //p11
              controlPoint1:CGPointMake(582.42, 810.35)
              controlPoint2:CGPointMake(628.93, 907.89)];
[bezierPath addCurveToPoint:CGPointMake(740.24, 628.93)  //p12
              controlPoint1:CGPointMake(834.7, 844.69)
              controlPoint2:CGPointMake(722.44, 699.2)];
[bezierPath addCurveToPoint:CGPointMake(883.23, 430.54)  //p0
              controlPoint1:CGPointMake(756.58, 564.39)
              controlPoint2:CGPointMake(899.19, 530.23)];
```

### 绘制贝塞尔曲线路径
创建贝塞尔路径实例后，通过应用填充或者描边绘制在上下文中。填充绘制，为路径内的所有区域添加颜色。描边绘制，使用路径线宽属性中的线宽来描画路径轮廓，仅绘制边缘。典型的绘图模式如下所示：

```
myPath.lineWidth = 4.0f;
[[UIColor blackColor] setStroke];
[[UIColor redColor] setFill];
[myPath fill];
[myPath stroke];
```

这个代码片段为路径设置线宽，并设置填充和描边的颜色，然后进行填充和描边。
代码清单4-1介绍了我认为更方便的方法。方法定义了一个类类别，添加了两种新的绘制方式，浓缩了绘制的过程，使用如下：
```
[myPath fill:[UIColor redColor]];
[myPath stroke:4 color:[UIColor blackColor]];
```
